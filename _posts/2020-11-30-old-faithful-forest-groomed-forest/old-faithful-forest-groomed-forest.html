<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #20794d; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007ba5; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #007ba5; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #007ba5; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #20794d; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>

  <!--radix_placeholder_meta_tags-->
  <title>Old faithful, Meet the Neighbors, and Lost in the Forest</title>
  
  <meta property="description" itemprop="description" content="Model description and evaluation."/>
  
  
  <!--  https://schema.org/Article -->
  <meta property="article:published" itemprop="datePublished" content="2020-11-30"/>
  <meta property="article:created" itemprop="dateCreated" content="2020-11-30"/>
  <meta name="article:author" content="Shaina Trevino, Jonathan Pedroza, Akhila Nekkanti"/>
  
  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="Old faithful, Meet the Neighbors, and Lost in the Forest"/>
  <meta property="og:type" content="article"/>
  <meta property="og:description" content="Model description and evaluation."/>
  <meta property="og:locale" content="en_US"/>
  
  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="Old faithful, Meet the Neighbors, and Lost in the Forest"/>
  <meta property="twitter:description" content="Model description and evaluation."/>
  
  <!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","date","output"]}},"value":[{"type":"character","attributes":{},"value":["Old faithful, Meet the Neighbors, and Lost in the Forest"]},{"type":"character","attributes":{},"value":["Model description and evaluation.\n"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","url"]}},"value":[{"type":"character","attributes":{},"value":["Shaina Trevino, Jonathan Pedroza, Akhila Nekkanti"]},{"type":"character","attributes":{},"value":["https://github.com/akhilanekkanti1/Final_ML_Blog"]}]}]},{"type":"character","attributes":{},"value":["11-30-2020"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained"]}},"value":[{"type":"logical","attributes":{},"value":[false]}]}]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["model1-lr.Rds","model2-knn.Rds","old-faithful-forest-groomed-forest_files/anchor-4.2.2/anchor.min.js","old-faithful-forest-groomed-forest_files/bowser-1.9.3/bowser.min.js","old-faithful-forest-groomed-forest_files/distill-2.2.21/template.v2.js","old-faithful-forest-groomed-forest_files/jquery-1.11.3/jquery.min.js","old-faithful-forest-groomed-forest_files/webcomponents-2.0.0/webcomponents.js"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->
  
  <style type="text/css">
  
  body {
    background-color: white;
  }
  
  .pandoc-table {
    width: 100%;
  }
  
  .pandoc-table>caption {
    margin-bottom: 10px;
  }
  
  .pandoc-table th:not([align]) {
    text-align: left;
  }
  
  .pagedtable-footer {
    font-size: 15px;
  }
  
  d-byline .byline {
    grid-template-columns: 2fr 2fr;
  }
  
  d-byline .byline h3 {
    margin-block-start: 1.5em;
  }
  
  d-byline .byline .authors-affiliations h3 {
    margin-block-start: 0.5em;
  }
  
  .authors-affiliations .orcid-id {
    width: 16px;
    height:16px;
    margin-left: 4px;
    margin-right: 4px;
    vertical-align: middle;
    padding-bottom: 2px;
  }
  
  d-title .dt-tags {
    margin-top: 1em;
    grid-column: text;
  }
  
  .dt-tags .dt-tag {
    text-decoration: none;
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0em 0.4em;
    margin-right: 0.5em;
    margin-bottom: 0.4em;
    font-size: 70%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }
  
  d-article table.gt_table td,
  d-article table.gt_table th {
    border-bottom: none;
  }
  
  .html-widget {
    margin-bottom: 2.0em;
  }
  
  .l-screen-inset {
    padding-right: 16px;
  }
  
  .l-screen .caption {
    margin-left: 10px;
  }
  
  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .shaded .shaded-content {
    background: white;
  }
  
  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }
  
  .hidden {
    display: none !important;
  }
  
  d-article {
    padding-top: 2.5rem;
    padding-bottom: 30px;
  }
  
  d-appendix {
    padding-top: 30px;
  }
  
  d-article>p>img {
    width: 100%;
  }
  
  d-article h2 {
    margin: 1rem 0 1.5rem 0;
  }
  
  d-article h3 {
    margin-top: 1.5rem;
  }
  
  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }
  
  /* Tweak code blocks */
  
  d-article div.sourceCode code,
  d-article pre code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }
  
  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: auto;
  }
  
  d-article div.sourceCode {
    background-color: white;
  }
  
  d-article div.sourceCode pre {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }
  
  d-article pre {
    font-size: 12px;
    color: black;
    background: none;
    margin-top: 0;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;
  
    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;
  
    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }
  
  d-article pre a {
    border-bottom: none;
  }
  
  d-article pre a:hover {
    border-bottom: none;
    text-decoration: underline;
  }
  
  @media(min-width: 768px) {
  
  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: visible !important;
  }
  
  d-article div.sourceCode pre {
    padding-left: 18px;
    font-size: 14px;
  }
  
  d-article pre {
    font-size: 14px;
  }
  
  }
  
  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }
  
  /* CSS for d-contents */
  
  .d-contents {
    grid-column: text;
    color: rgba(0,0,0,0.8);
    font-size: 0.9em;
    padding-bottom: 1em;
    margin-bottom: 1em;
    padding-bottom: 0.5em;
    margin-bottom: 1em;
    padding-left: 0.25em;
    justify-self: start;
  }
  
  @media(min-width: 1000px) {
    .d-contents.d-contents-float {
      height: 0;
      grid-column-start: 1;
      grid-column-end: 4;
      justify-self: center;
      padding-right: 3em;
      padding-left: 2em;
    }
  }
  
  .d-contents nav h3 {
    font-size: 18px;
    margin-top: 0;
    margin-bottom: 1em;
  }
  
  .d-contents li {
    list-style-type: none
  }
  
  .d-contents nav > ul {
    padding-left: 0;
  }
  
  .d-contents ul {
    padding-left: 1em
  }
  
  .d-contents nav ul li {
    margin-top: 0.6em;
    margin-bottom: 0.2em;
  }
  
  .d-contents nav a {
    font-size: 13px;
    border-bottom: none;
    text-decoration: none
    color: rgba(0, 0, 0, 0.8);
  }
  
  .d-contents nav a:hover {
    text-decoration: underline solid rgba(0, 0, 0, 0.6)
  }
  
  .d-contents nav > ul > li > a {
    font-weight: 600;
  }
  
  .d-contents nav > ul > li > ul {
    font-weight: inherit;
  }
  
  .d-contents nav > ul > li > ul > li {
    margin-top: 0.2em;
  }
  
  
  .d-contents nav ul {
    margin-top: 0;
    margin-bottom: 0.25em;
  }
  
  .d-article-with-toc h2:nth-child(2) {
    margin-top: 0;
  }
  
  
  /* Figure */
  
  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }
  
  .figure img {
    width: 100%;
  }
  
  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }
  
  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }
  
  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }
  
  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }
  
  /* Citations */
  
  d-article .citation {
    color: inherit;
    cursor: inherit;
  }
  
  div.hanging-indent{
    margin-left: 1em; text-indent: -1em;
  }
  
  
  /* Tweak 1000px media break to show more text */
  
  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }
  
    .grid {
      grid-column-gap: 16px;
    }
  
    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }
  
  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }
  
    .grid {
      grid-column-gap: 32px;
    }
  }
  
  
  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */
  
  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }
  
  /* Include appendix styles here so they can be overridden */
  
  d-appendix {
    contain: layout style;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-top: 60px;
    margin-bottom: 0;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    color: rgba(0,0,0,0.5);
    padding-top: 60px;
    padding-bottom: 48px;
  }
  
  d-appendix h3 {
    grid-column: page-start / text-start;
    font-size: 15px;
    font-weight: 500;
    margin-top: 1em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.65);
  }
  
  d-appendix h3 + * {
    margin-top: 1em;
  }
  
  d-appendix ol {
    padding: 0 0 0 15px;
  }
  
  @media (min-width: 768px) {
    d-appendix ol {
      padding: 0 0 0 30px;
      margin-left: -30px;
    }
  }
  
  d-appendix li {
    margin-bottom: 1em;
  }
  
  d-appendix a {
    color: rgba(0, 0, 0, 0.6);
  }
  
  d-appendix > * {
    grid-column: text;
  }
  
  d-appendix > d-footnote-list,
  d-appendix > d-citation-list,
  d-appendix > distill-appendix {
    grid-column: screen;
  }
  
  /* Include footnote styles here so they can be overridden */
  
  d-footnote-list {
    contain: layout style;
  }
  
  d-footnote-list > * {
    grid-column: text;
  }
  
  d-footnote-list a.footnote-backlink {
    color: rgba(0,0,0,0.3);
    padding-left: 0.5em;
  }
  
  
  
  /* Anchor.js */
  
  .anchorjs-link {
    /*transition: all .25s linear; */
    text-decoration: none;
    border-bottom: none;
  }
  *:hover > .anchorjs-link {
    margin-left: -1.125em !important;
    text-decoration: none;
    border-bottom: none;
  }
  
  /* Social footer */
  
  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }
  
  .disqus-comments {
    margin-right: 30px;
  }
  
  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }
  
  #disqus_thread {
    margin-top: 30px;
  }
  
  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }
  
  .article-sharing a:hover {
    border-bottom: none;
  }
  
  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }
  
  .subscribe p {
    margin-bottom: 0.5em;
  }
  
  
  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }
  
  
  .sidebar-section.custom {
    font-size: 12px;
    line-height: 1.6em;
  }
  
  .custom p {
    margin-bottom: 0.5em;
  }
  
  /* Styles for listing layout (hide title) */
  .layout-listing d-title, .layout-listing .d-title {
    display: none;
  }
  
  /* Styles for posts lists (not auto-injected) */
  
  
  .posts-with-sidebar {
    padding-left: 45px;
    padding-right: 45px;
  }
  
  .posts-list .description h2,
  .posts-list .description p {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }
  
  .posts-list .description h2 {
    font-weight: 700;
    border-bottom: none;
    padding-bottom: 0;
  }
  
  .posts-list h2.post-tag {
    border-bottom: 1px solid rgba(0, 0, 0, 0.2);
    padding-bottom: 12px;
  }
  .posts-list {
    margin-top: 60px;
    margin-bottom: 24px;
  }
  
  .posts-list .post-preview {
    text-decoration: none;
    overflow: hidden;
    display: block;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    padding: 24px 0;
  }
  
  .post-preview-last {
    border-bottom: none !important;
  }
  
  .posts-list .posts-list-caption {
    grid-column: screen;
    font-weight: 400;
  }
  
  .posts-list .post-preview h2 {
    margin: 0 0 6px 0;
    line-height: 1.2em;
    font-style: normal;
    font-size: 24px;
  }
  
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.4em;
    font-size: 16px;
  }
  
  .posts-list .post-preview .thumbnail {
    box-sizing: border-box;
    margin-bottom: 24px;
    position: relative;
    max-width: 500px;
  }
  .posts-list .post-preview img {
    width: 100%;
    display: block;
  }
  
  .posts-list .metadata {
    font-size: 12px;
    line-height: 1.4em;
    margin-bottom: 18px;
  }
  
  .posts-list .metadata > * {
    display: inline-block;
  }
  
  .posts-list .metadata .publishedDate {
    margin-right: 2em;
  }
  
  .posts-list .metadata .dt-authors {
    display: block;
    margin-top: 0.3em;
    margin-right: 2em;
  }
  
  .posts-list .dt-tags {
    display: block;
    line-height: 1em;
  }
  
  .posts-list .dt-tags .dt-tag {
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0.3em 0.4em;
    margin-right: 0.2em;
    margin-bottom: 0.4em;
    font-size: 60%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }
  
  .posts-list img {
    opacity: 1;
  }
  
  .posts-list img[data-src] {
    opacity: 0;
  }
  
  .posts-more {
    clear: both;
  }
  
  
  .posts-sidebar {
    font-size: 16px;
  }
  
  .posts-sidebar h3 {
    font-size: 16px;
    margin-top: 0;
    margin-bottom: 0.5em;
    font-weight: 400;
    text-transform: uppercase;
  }
  
  .sidebar-section {
    margin-bottom: 30px;
  }
  
  .categories ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }
  
  .categories li {
    color: rgba(0, 0, 0, 0.8);
    margin-bottom: 0;
  }
  
  .categories li>a {
    border-bottom: none;
  }
  
  .categories li>a:hover {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  }
  
  .categories .active {
    font-weight: 600;
  }
  
  .categories .category-count {
    color: rgba(0, 0, 0, 0.4);
  }
  
  
  @media(min-width: 768px) {
    .posts-list .post-preview h2 {
      font-size: 26px;
    }
    .posts-list .post-preview .thumbnail {
      float: right;
      width: 30%;
      margin-bottom: 0;
    }
    .posts-list .post-preview .description {
      float: left;
      width: 45%;
    }
    .posts-list .post-preview .metadata {
      float: left;
      width: 20%;
      margin-top: 8px;
    }
    .posts-list .post-preview p {
      margin: 0 0 12px 0;
      line-height: 1.5em;
      font-size: 16px;
    }
    .posts-with-sidebar .posts-list {
      float: left;
      width: 75%;
    }
    .posts-with-sidebar .posts-sidebar {
      float: right;
      width: 20%;
      margin-top: 60px;
      padding-top: 24px;
      padding-bottom: 24px;
    }
  }
  
  
  /* Improve display for browsers without grid (IE/Edge <= 15) */
  
  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }
  
  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }
  
  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }
  
  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }
  
  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }
  
  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }
  
  
  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }
  
  .downlevel .footnotes ol {
    padding-left: 13px;
  }
  
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }
  
  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }
  
  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }
  
  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;
  
    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;
  
    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }
  
  .downlevel .posts-list .post-preview {
    color: inherit;
  }
  
  
  
  </style>
  
  <script type="application/javascript">
  
  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }
  
  // show body when load is complete
  function on_load_complete() {
  
    // add anchors
    if (window.anchors) {
      window.anchors.options.placement = 'left';
      window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
    }
  
  
    // set body to visible
    document.body.style.visibility = 'visible';
  
    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }
  
    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }
  
  function init_distill() {
  
    init_common();
  
    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);
  
    // create d-title
    $('.d-title').changeElementType('d-title');
  
    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);
  
    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();
  
    // move posts container into article
    $('.posts-container').appendTo($('d-article'));
  
    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');
  
    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;
  
    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();
  
    // move refs into #references-listing
    $('#references-listing').replaceWith($('#refs'));
  
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-contents a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });
  
    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');
  
    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {
  
      // capture layout
      var layout = $(this).attr('data-layout');
  
      // apply layout to markdown level block elements
      var elements = $(this).children().not('div.sourceCode, pre, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });
  
  
      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });
  
    // remove code block used to force  highlighting css
    $('.distill-force-highlighting-css').parent().remove();
  
    // remove empty line numbers inserted by pandoc when using a
    // custom syntax highlighting theme
    $('code.sourceCode a:empty').remove();
  
    // load distill framework
    load_distill_framework();
  
    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {
  
      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;
  
      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');
  
      // article with toc class
      $('.d-contents').parent().addClass('d-article-with-toc');
  
      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');
  
      // add orcid ids
      $('.authors-affiliations').find('.author').each(function(i, el) {
        var orcid_id = front_matter.authors[i].orcidID;
        if (orcid_id) {
          var a = $('<a></a>');
          a.attr('href', 'https://orcid.org/' + orcid_id);
          var img = $('<img></img>');
          img.addClass('orcid-id');
          img.attr('alt', 'ORCID ID');
          img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
          a.append(img);
          $(this).append(a);
        }
      });
  
      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }
  
      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');
  
      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");
  
      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }
  
       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }
  
      // remove d-appendix and d-footnote-list local styles
      $('d-appendix > style:first-child').remove();
      $('d-footnote-list > style:first-child').remove();
  
      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();
  
      // clear polling timer
      clearInterval(tid);
  
      // show body now that everything is ready
      on_load_complete();
    }
  
    var tid = setInterval(distill_post_process, 50);
    distill_post_process();
  
  }
  
  function init_downlevel() {
  
    init_common();
  
     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));
  
    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
  
    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();
  
    // remove toc
    $('.d-contents').remove();
  
    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });
  
  
    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);
  
    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);
  
    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();
  
    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();
  
    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));
  
    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });
  
    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));
  
    $('body').addClass('downlevel');
  
    on_load_complete();
  }
  
  
  function init_common() {
  
    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};
  
        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });
  
        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);
  
    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});
  
    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });
  
      }
    });
  
    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });
  
    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.distill-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
      });
    }
  
    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');
  
    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");
  
    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();
  
    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }
  
  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });
  
  </script>
  
  <!--/radix_placeholder_distill-->
  <script src="old-faithful-forest-groomed-forest_files/jquery-1.11.3/jquery.min.js"></script>
  <script src="old-faithful-forest-groomed-forest_files/anchor-4.2.2/anchor.min.js"></script>
  <script src="old-faithful-forest-groomed-forest_files/bowser-1.9.3/bowser.min.js"></script>
  <script src="old-faithful-forest-groomed-forest_files/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="old-faithful-forest-groomed-forest_files/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Old faithful, Meet the Neighbors, and Lost in the Forest","description":"Model description and evaluation.","authors":[{"author":"Shaina Trevino, Jonathan Pedroza, Akhila Nekkanti","authorURL":"https://github.com/akhilanekkanti1/Final_ML_Blog","affiliation":"&nbsp;","affiliationURL":"#","orcidID":""}],"publishedDate":"2020-11-30T00:00:00.000-08:00","citationText":"Nekkanti, 2020"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Old faithful, Meet the Neighbors, and Lost in the Forest</h1>
<!--radix_placeholder_categories-->
<!--/radix_placeholder_categories-->
<p><p>Model description and evaluation.</p></p>
</div>

<div class="d-byline">
  Shaina Trevino, Jonathan Pedroza, Akhila Nekkanti <a href="https://github.com/akhilanekkanti1/Final_ML_Blog" class="uri">https://github.com/akhilanekkanti1/Final_ML_Blog</a> 
  
<br/>11-30-2020
</div>

<div class="d-article">
<h1 id="overview">Overview</h1>
<p>In this post we are going to describe our process for the three machine learning models that we ran (e.g., penalized regression, k-nearest neighbor, random forest) and compare the performance of all models. The results that are presented are from the full dataset described in the previous post. <a href="https://akhilanekkanti1.github.io/Final_ML_Blog/posts/2020-11-30-shoe-me-what-youre-working-with-data-desc/">Check it out here.</a>. Since the full dataset was so large, we utilized a High Performance Computing (HPC) cluster from the University of Oregon (Talapas) to run all models.</p>
<h2 id="split-the-data">Split the Data</h2>
<p>Before we start fitting models, the first step is to split our data into two parts: training and testing data. To do this, we use <code>initial_split</code> to split the data and then define our training and testing set. Notice that we also used stratified sampling (<code>strata = "score"</code>) when splitting our data to ensure the training and testing sets have similar outcome responses.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>1272020</span><span class='op'>)</span>

<span class='va'>d_split</span> <span class='op'>&lt;-</span> <span class='fu'>initial_split</span><span class='op'>(</span><span class='va'>d</span>, strata <span class='op'>=</span> <span class='st'>"score"</span><span class='op'>)</span>

<span class='va'>d_train</span> <span class='op'>&lt;-</span> <span class='fu'>training</span><span class='op'>(</span><span class='va'>d_split</span><span class='op'>)</span>
<span class='va'>d_test</span>  <span class='op'>&lt;-</span> <span class='fu'>testing</span><span class='op'>(</span><span class='va'>d_split</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Then, we take our testing set and create a k-fold cross validation object. This splits our training set into 10 different samples of data each with their own training and testing set. We will use this object to evaluate the performance metrics for each model across all 10 samples.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>1272020</span><span class='op'>)</span>

<span class='va'>train_cv</span> <span class='op'>&lt;-</span> <span class='fu'>vfold_cv</span><span class='op'>(</span><span class='va'>d_train</span>, strata <span class='op'>=</span> <span class='st'>"score"</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h2 id="define-the-recipe">Define the Recipe</h2>
<p>This recipe is explained in the previous post. However, we provided the code here as well for completeness. We will use this same recipe for all models.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>rec_yoself</span> <span class='op'>&lt;-</span> <span class='fu'>recipe</span><span class='op'>(</span><span class='va'>score</span> <span class='op'>~</span> <span class='va'>.</span>,data <span class='op'>=</span> <span class='va'>d_train</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>step_mutate</span><span class='op'>(</span>tst_dt <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='fu'>lubridate</span><span class='fu'>::</span><span class='fu'><a href='http://lubridate.tidyverse.org/reference/ymd_hms.html'>mdy_hms</a></span><span class='op'>(</span><span class='va'>tst_dt</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>update_role</span><span class='op'>(</span><span class='fu'>contains</span><span class='op'>(</span><span class='st'>"id"</span><span class='op'>)</span>, <span class='va'>ncessch</span>, new_role <span class='op'>=</span> <span class='st'>"id vars"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>step_unknown</span><span class='op'>(</span><span class='fu'>all_nominal</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>step_novel</span><span class='op'>(</span><span class='fu'>all_nominal</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>step_dummy</span><span class='op'>(</span><span class='fu'>all_nominal</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>step_nzv</span><span class='op'>(</span><span class='fu'>all_predictors</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>step_normalize</span><span class='op'>(</span><span class='fu'>all_numeric</span><span class='op'>(</span><span class='op'>)</span>, <span class='op'>-</span><span class='fu'>all_outcomes</span><span class='op'>(</span><span class='op'>)</span>, <span class='op'>-</span><span class='fu'>has_role</span><span class='op'>(</span><span class='st'>"id vars"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>step_medianimpute</span><span class='op'>(</span><span class='fu'>all_numeric</span><span class='op'>(</span><span class='op'>)</span>, <span class='op'>-</span><span class='fu'>all_outcomes</span><span class='op'>(</span><span class='op'>)</span>, <span class='op'>-</span><span class='fu'>has_role</span><span class='op'>(</span><span class='st'>"id vars"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>  
  <span class='fu'>step_interact</span><span class='op'>(</span>terms <span class='op'>=</span> <span class='op'>~</span><span class='va'>lat</span><span class='op'>:</span><span class='va'>lon</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>step_nzv</span><span class='op'>(</span><span class='fu'>all_predictors</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h1 id="model-1-old-faithful---penalized-regression-model">Model 1: Old Faithful - Penalized Regression Model</h1>
<p>Finally, we are ready to create our first model. This will be a penalized regression, specifically an elastic net model. Linear regression models are usually easier to interpret and less computationally intensive.</p>
<p>To run an enet model, you must specify the penalty argument (for dealing with multicolinearity) and the mixture argument (proportion of ridge [0] to lasso [1] models). For our purposes, we will tune these parameters to find the values that result in the best model performance.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>lr_mod</span> <span class='op'>&lt;-</span> <span class='fu'>linear_reg</span><span class='op'>(</span><span class='op'>)</span>  <span class='op'>%&gt;%</span>
  <span class='fu'>set_engine</span><span class='op'>(</span><span class='st'>"glmnet"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>set_mode</span><span class='op'>(</span><span class='st'>"regression"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>set_args</span><span class='op'>(</span>penalty <span class='op'>=</span> <span class='fu'>tune</span><span class='op'>(</span><span class='op'>)</span>,
           mixture <span class='op'>=</span> <span class='fu'>tune</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h3 id="workflow">Workflow</h3>
<p>After specifying our enet model, we use the <code>workflow</code> package to combine our recipe and our model into one workflow object. This makes it easier to monitor and update your recipe and model that you are working with.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>lr_flo</span> <span class='op'>&lt;-</span> <span class='fu'>workflow</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>add_recipe</span><span class='op'>(</span><span class='va'>rec_yoself</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>add_model</span><span class='op'>(</span><span class='va'>lr_mod</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h4 id="tune-model">Tune Model</h4>
<p>We are now ready to tune our enet model. To tune the model we first need to create a grid for tuning parameters. Since we are using a linear regression model, we decided to use a regular grid with our two hyperparameters (<code>penalty()</code> and <code>mixture()</code>). We also specified 30 levels (i.e., 30 values for each hyperparameter) to create the grid.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='co'>#create grid</span>
<span class='va'>lr_grd</span> <span class='op'>&lt;-</span> <span class='fu'>grid_regular</span><span class='op'>(</span><span class='fu'>penalty</span><span class='op'>(</span><span class='op'>)</span>, <span class='fu'>mixture</span><span class='op'>(</span><span class='op'>)</span>, levels <span class='op'>=</span> <span class='fl'>30</span><span class='op'>)</span>

<span class='co'>#tune model </span>
<span class='fu'>tictoc</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/tictoc/man/tic.html'>tic</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='va'>lr_res</span> <span class='op'>&lt;-</span> <span class='fu'>tune</span><span class='fu'>::</span><span class='fu'><a href='https://tune.tidymodels.org/reference/tune_grid.html'>tune_grid</a></span><span class='op'>(</span><span class='va'>lr_flo</span>, resamples <span class='op'>=</span> <span class='va'>train_cv</span>, grid <span class='op'>=</span> <span class='va'>lr_grd</span>,
                           control <span class='op'>=</span> <span class='fu'>tune</span><span class='fu'>::</span><span class='fu'><a href='https://tune.tidymodels.org/reference/control_grid.html'>control_resamples</a></span><span class='op'>(</span>save_pred <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'>tictoc</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/tictoc/man/tic.html'>toc</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>When we ran the previous model on the HPC cluster, it only took 26 minutes to tune. The values that lead to the highest performance (i.e., lowest RMSE) for our tuning parameters were:</p>
<ul>
<li><p>Penalty = &lt;0.00</p></li>
<li><p>Mixture = 0.03</p></li>
</ul>
<p>Note: Because both values are so low, we would expect to get very similar results with a ridge regression model and it would be less computationally intensive.</p>
<h4 id="apply-best-tuning-parameters">Apply Best Tuning Parameters</h4>
<p>We can then apply these values to our arguments in our model with the select <code>select_best</code> function. Remember to update and finalize your workflow with the new model as well.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='co'>#select best tuning parameters</span>
<span class='va'>lr_best</span> <span class='op'>&lt;-</span> <span class='va'>lr_res</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select_best</span><span class='op'>(</span>metric <span class='op'>=</span> <span class='st'>"rmse"</span><span class='op'>)</span>

<span class='co'>#finalize model in workflow</span>
<span class='va'>lr_flo_final</span> <span class='op'>&lt;-</span> <span class='fu'>finalize_workflow</span><span class='op'>(</span><span class='va'>lr_flo</span>, <span class='va'>lr_best</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h3 id="model-1-results">Model 1 Results</h3>
<p>Once we have finalized our model and workflow, we can use the <code>last_fit()</code> function to apply our recipe and model to the <code>initial_split</code> object we made. This will evaluate the model performance on the testing set. We then use the <code>collect_metrics()</code> function to view our performance metrics on the test set.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='co'>#evaluate on test set with last_fit</span>
<span class='va'>lr_final_res</span> <span class='op'>&lt;-</span> <span class='fu'>last_fit</span><span class='op'>(</span>
  <span class='va'>lr_flo_final</span>,
  split <span class='op'>=</span> <span class='va'>d_split</span><span class='op'>)</span>

<span class='co'>#view performance metric</span>
<span class='va'>lr_final_res</span> <span class='op'>%&gt;%</span>
  <span class='fu'>collect_metrics</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>`.metric`</span> <span class='op'>==</span> <span class='st'>"rmse"</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<pre><code># A tibble: 1 x 4
  .metric .estimator .estimate .config             
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;fct&gt;               
1 rmse    standard        89.0 Preprocessor1_Model1</code></pre>
</div>
<p>As you can see, our final performance metric (RMSE) for our penalized regression model is <code>89.03</code>.</p>
<h4 id="get-predictions">Get Predictions</h4>
<p>We also wanted to note that if you wanted to extract predictions from the test dataset within the split object (e.g., <code>d_split</code>), you can use the <code>collect_predictions()</code> function. However, our goal is to compare this model performance with two different models and then extract predictions from the best one.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>test_preds</span> <span class='op'>&lt;-</span> <span class='va'>lr_final_res</span> <span class='op'>%&gt;%</span> <span class='fu'>collect_predictions</span><span class='op'>(</span><span class='op'>)</span>
<span class='va'>test_preds</span>
</code></pre>
</div>
</div>
<h1 id="model-2-meet-the-neighbors---k-nearest-neighbor-knn-an">Model 2: Meet the Neighbors - K Nearest Neighbor (KNN) (AN)</h1>
<h4 id="well-use-the-same-data-and-recipe-from-our-first-model---this-way-we-can-see-whether-improvements-to-model-fit-are-actually-due-to-an-improved-model.">We’ll use the same data and recipe from our first Model - This way, we can see whether improvements to model fit are actually due to an improved model.</h4>
<h5 id="a-k-nearest-neighbor-knn-model-aims-to-find-the-closest-neighbors-or-closest-data-points-in-the-predictor-space.-this-means-that-the-model-uses-information-from-previous-samples-to-find-the-points-that-are-closest-in-proximity-to-the-new-sample.-while-knn-models-can-be-computationally-inefficient-they-make-fewer-assumptions-about-the-data-and-may-be-preferable-when-datasets-are-nonparametric-or-where-distributions-are-largely-unknown.-we-chose-this-model-for-our-case-because-many-of-our-predictors-are-non-parametric-and-our-dataset-is-very-large.">A K nearest neighbor (KNN) model aims to find the closest <em>neighbors</em>, or closest data points in the predictor space. This means that the model uses information from previous samples to find the points that are closest in proximity to the new sample. While KNN models can be computationally inefficient, they make fewer assumptions about the data and may be preferable when datasets are nonparametric, or where distributions are largely unknown. We chose this model for our case because many of our predictors are non-parametric and our dataset is very large.</h5>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>knn_mod &lt;-<span class="st"> </span><span class="kw">nearest_neighbor</span>()  <span class="op">%&gt;%</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="st">  </span><span class="kw">set_engine</span>(<span class="st">&quot;kknn&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span></code></pre></div>
</div>
<h5 id="when-specifying-the-model-we-set-the-mode-to-regression.-this-tells-it-to-take-the-average-outcome-of-k-cases-rather-than-the-mode.-because-our-outcome-is-continuous-we-went-with-the-regression-method.">When specifying the model, we set the mode to “regression”. This tells it to take the average outcome of <em>K</em> cases, rather than the mode. Because our outcome is continuous, we went with the regression method.</h5>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co">#knn_mod &lt;- nearest_neighbor()  %&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="co">#  set_engine(&quot;kknn&quot;) %&gt;% </span></span>
<span id="cb3-3"><a href="#cb3-3"></a>  <span class="kw">set_mode</span>(<span class="st">&quot;regression&quot;</span>) <span class="op">%&gt;%</span></span></code></pre></div>
</div>
<h4 id="next-we-determine-how-to-identify-the-neighbors.-the-defaults-from-the-kknn-package-include-5-neighbors-set-the-weight_func-to-optimal-and-the-dist_power-to-2.">Next we determine how to identify the neighbors. The defaults from the <code>{kknn}</code> package include 5 neighbors, set the <code>weight_func</code> to “optimal”, and the <code>dist_power()</code> to “2”.</h4>
<ul>
<li><p>If K is small (e.g., 1), there is greater potential for over-fitting as it is more susceptible to changes in the data (think low bias but high variance). Larger values of K means the model will be looking at potentially irrelevant data points. This can be helpgul when data are noisy, but not always. Think high bias, and low variance.</p></li>
<li><p>The weight_func determines how to weight the distances between samples. In other words, it determines whether or not to penalize for a point being farther away.</p></li>
<li><p>The dist_power function specifies how far points should be.</p></li>
</ul>
<h5 id="here-we-set-each-of-these-parameters-to-tune-so-that-the-model-could-determine-the-best-values-based-on-the-data.">Here, we set each of these parameters to ‘tune()’, so that the model could determine the best values based on the data.</h5>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co">#knn_mod &lt;- nearest_neighbor()  %&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="co">#  set_engine(&quot;kknn&quot;) %&gt;% </span></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="co">#  set_mode(&quot;regression&quot;) %&gt;% </span></span>
<span id="cb4-4"><a href="#cb4-4"></a>  <span class="kw">set_args</span>(<span class="dt">neighbors =</span> <span class="kw">tune</span>()),</span>
<span id="cb4-5"><a href="#cb4-5"></a>           weight_func =<span class="st"> </span><span class="kw">tune</span>(),</span>
<span id="cb4-6"><a href="#cb4-6"></a>           dist_power =<span class="st"> </span><span class="kw">tune</span>()<span class="er">)</span></span></code></pre></div>
</div>
<h5 id="unfortunately-setting-all-three-parameters-to-tune-was-computationally-inefficient.-that-is-it-took-longer-than-16-hours-to-run-on-a-cluster-computer.-so-we-removed-the-tuning-parameters-for-weight_func-and-dist_power-and-left-these-to-the-defaults.-we-felt-it-was-important-to-tune-the-neighbors-however.">Unfortunately, setting all three parameters to ‘tune()’ was computationally inefficient. That is, it took longer than 16 hours to run on a cluster computer. So, we removed the tuning parameters for ‘weight_func’ and ‘dist_power’, and left these to the defaults. We felt it was important to tune the neighbors however.</h5>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>knn_mod</span> <span class='op'>&lt;-</span> <span class='fu'>nearest_neighbor</span><span class='op'>(</span><span class='op'>)</span>  <span class='op'>%&gt;%</span>
  <span class='fu'>set_engine</span><span class='op'>(</span><span class='st'>"kknn"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>set_mode</span><span class='op'>(</span><span class='st'>"regression"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>set_args</span><span class='op'>(</span>neighbors <span class='op'>=</span> <span class='fu'>tune</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span><span class='co'>#,</span>
           <span class='co'>#weight_func = tune()#,</span>
           <span class='co'>#dist_power = tune())</span>
</code></pre>
</div>
</div>
<h5 id="woohoo-model-specified-now-to-create-a-workflow-and-start-running-things.-here-we-use-a-workflow-to-bundle-our-preprocessing-and-modelling-together.-were-using-the-same-recipe-as-before-rec_yoself-and-the-model-we-just-created-knn_mod.">Woohoo! Model = specified! Now to create a workflow and start running things. Here we use a workflow to bundle our preprocessing and modelling together. We’re using the same recipe as before, ‘rec_yoself’, and the model we just created, ‘knn_mod’.</h5>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>knn_flo</span> <span class='op'>&lt;-</span> <span class='va'>lr_flo</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>update_model</span><span class='op'>(</span><span class='va'>knn_mod</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h5 id="we-aimed-to-use-a-space-filling-design-when-specifying-our-non-regular-grid.-this-type-of-design-aims-to-keep-potential-points-away-from-each-other-while-also-encompassing-the-entire-parameter-space.-here-we-specify-the-parameters-as-well-as-the-range-for-neighbors-prior-to-creating-the-grid.-note---this-is-prior-to-removing-the-tuning-parameters-above">We aimed to use a space-filling design when specifying our non-regular grid. This type of design aims to keep potential points away from each other while also encompassing the entire parameter space. Here, we specify the parameters, as well as the range for neighbors, prior to creating the grid. (*Note - this is prior to removing the tuning parameters above)</h5>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>knn_par</span> <span class='op'>&lt;-</span> <span class='fu'>parameters</span><span class='op'>(</span><span class='fu'>neighbors</span><span class='op'>(</span>range <span class='op'>=</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>10</span>, <span class='fl'>75</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>, <span class='fu'>weight_func</span><span class='op'>(</span><span class='op'>)</span>, <span class='fu'>dist_power</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='co'>#testing with smaller range due to computation</span>
<span class='va'>knn_grd</span> <span class='op'>&lt;-</span> <span class='fu'>grid_max_entropy</span><span class='op'>(</span><span class='va'>knn_par</span>, size <span class='op'>=</span> <span class='fl'>30</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h5 id="unfortunately-this-too-contributed-to-a-computationally-inefficient-model.-so-we-used-the-defaults-for-grid_max_entropy-and-only-specified-neighbors-and-size-of-the-grid.">Unfortunately, this too contributed to a computationally inefficient model. So, we used the defaults for <code>grid_max_entropy()</code> and only specified <code>neighbors()</code> and size of the grid.</h5>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='co'>#knn_par &lt;- parameters(neighbors(range = (c(10, 75))), weight_func(), dist_power()) #testing with smaller range due to computation</span>
<span class='va'>knn_grd</span> <span class='op'>&lt;-</span> <span class='fu'>grid_max_entropy</span><span class='op'>(</span><span class='fu'>neighbors</span><span class='op'>(</span><span class='op'>)</span>, size <span class='op'>=</span> <span class='fl'>30</span><span class='op'>)</span> <span class='co'>#testing with smaller size due to computation </span>
</code></pre>
</div>
</div>
<h5 id="finally-we-are-ready-to-tune-our-grid-according-to-our-cross-fold-validated-data.-we-specify-our-workflow-knn_flo-the-resamples-we-want-the-model-to-use-train_cv-and-the-grid-we-created-above-knn_grd.">Finally, we are ready to tune our grid according to our cross-fold validated data. We specify our workflow (knn_flo), the resamples we want the model to use (train_cv), and the grid we created above (knn_grd).</h5>
<h5 id="youll-notice-in-between-the-hashtags-we-include-some-code-to-employ-parallel-processing.-this-allows-the-model-to-run-on-each-sample-simultaneously-in-an-attempt-to-cut-down-on-computation-time.">You’ll notice in between the hashtags, we include some code to employ parallel processing. This allows the model to run on each sample simultaneously, in an attempt to cut down on computation time.</h5>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='co'>#</span>
<span class='va'>cl</span> <span class='op'>&lt;-</span> <span class='fu'>makePSOCKcluster</span><span class='op'>(</span><span class='va'>all_cores</span><span class='op'>)</span>
<span class='fu'>registerDoParallel</span><span class='op'>(</span><span class='va'>cl</span><span class='op'>)</span>
<span class='fu'>foreach</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/foreach/man/getDoParWorkers.html'>getDoParWorkers</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='fu'>clusterEvalQ</span><span class='op'>(</span><span class='va'>cl</span>, <span class='op'>{</span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://tidymodels.tidymodels.org'>tidymodels</a></span><span class='op'>)</span><span class='op'>}</span><span class='op'>)</span>
<span class='co'>#</span>

<span class='va'>knn_res</span> <span class='op'>&lt;-</span> <span class='fu'>tune</span><span class='fu'>::</span><span class='fu'><a href='https://tune.tidymodels.org/reference/tune_grid.html'>tune_grid</a></span><span class='op'>(</span><span class='va'>knn_flo</span>, resamples <span class='op'>=</span> <span class='va'>train_cv</span>, grid <span class='op'>=</span> <span class='va'>knn_grd</span>,
                           control <span class='op'>=</span> <span class='fu'>tune</span><span class='fu'>::</span><span class='fu'><a href='https://tune.tidymodels.org/reference/control_grid.html'>control_resamples</a></span><span class='op'>(</span>save_pred <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'>#</span>
<span class='fu'>parallel</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/parallel/makeCluster.html'>stopCluster</a></span><span class='op'>(</span><span class='va'>cl</span><span class='op'>)</span>
<span class='co'>#</span>
</code></pre>
</div>
</div>
<h5 id="lastly-we-want-to-select-the-best-tuning-parameters-and-use-them-to-finalize-the-workflow.-as-you-may-have-guessed-the-only-tuned-parameters-are-the-number-of-neighbors---since-both-the-dist_func-and-weight_func-were-too-computationally-expensive-to-move-away-from-defaults.-the-optimal-number-of-neighbors-for-our-model-was-10.">Lastly, we want to select the best tuning parameters and use them to finalize the workflow. As you may have guessed, the only tuned parameters are the number of neighbors - since both the dist_func and weight_func were too computationally expensive to move away from defaults. The optimal number of neighbors for our model was <code>10</code>.</h5>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>knn_best</span> <span class='op'>&lt;-</span> <span class='va'>knn_res</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select_best</span><span class='op'>(</span>metric <span class='op'>=</span> <span class='st'>"rmse"</span><span class='op'>)</span>

<span class='va'>knn_flo_final</span> <span class='op'>&lt;-</span> <span class='fu'>finalize_workflow</span><span class='op'>(</span><span class='va'>knn_flo</span>, <span class='va'>knn_best</span><span class='op'>)</span>

<span class='fu'>registerDoSEQ</span><span class='op'>(</span><span class='op'>)</span> 
<span class='va'>knn_final_res</span> <span class='op'>&lt;-</span> <span class='fu'>last_fit</span><span class='op'>(</span>
  <span class='va'>knn_flo_final</span>,
  split <span class='op'>=</span> <span class='va'>d_split</span><span class='op'>)</span>

<span class='va'>knn_final_res</span> <span class='op'>%&gt;%</span>
  <span class='fu'>collect_metrics</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h5 id="since-we-ran-our-model-on-the-hpc-we-are-reading-in-our-model-first.">Since we ran our model on the HPC, we are reading in our model first.</h5>
<div class="layout-chunk" data-layout="l-body">

</div>
<h5 id="our-final-performance-metric-rmse-for-our-knn-regression-model-is-92.20.-yikes-this-metric-is-not-so-great-but-our-total-elapsed-time-of-1772.517-seconds-on-a-cluster-computer-is-pretty-amazing.-the-high-rmse-may-be-due-to-our-leaving-in-the-defaults-for-dist_power-and-weight_func-when-tuning-our-model.-next-steps-if-time-allowed-would-include-tuning-just-the-weight_func-and-specifying-a-value-for-dist_power-based-on-the-manhattan-measure-since-most-of-our-predictors-are-categorical.">Our final performance metric (RMSE) for our KNN regression model is <code>92.20</code>. Yikes! This metric is not so great, but our total elapsed time of 1772.517 seconds on a cluster computer is pretty amazing. The high RMSE may be due to our leaving in the defaults for <code>dist_power()</code> and <code>weight_func</code> when tuning our model. Next steps, if time allowed, would include tuning just the <code>weight_func</code>, and specifying a value for <code>dist_power</code> based on the Manhattan measure (since most of our predictors are categorical).</h5>
<h1 id="model-3-lost-in-the-forest---random-forest-jp">Model 3: Lost in the Forest - Random Forest (JP)</h1>
<p>Okay, so we’ve tested a elastic net regression and a KNN model. We’ve seen how simple to implement the elastic net regression was and we’ve experienced the waiting game of running a KNN model. <img src="https://media.giphy.com/media/9SIXFu7bIUYHhFc19G/giphy.gif" alt="well were waiting" /></p>
<p>Let’s move on to our final model, a random forest model. Now, what is a random forest model? Random forest stems (ha!) from a decision tree but rather than have one tree, we will have 1000 trees.</p>
<figure>
<img src="https://media.giphy.com/media/RbDxrcG2deKnm/giphy.gif" alt="" /><figcaption>Charlie brown</figcaption>
</figure>
<p>Random forest is also different from bagged trees because while there are multiple trees, bagged trees aggregates the predictions across all trees and has the issue of correlations between the nodes for trees. So random forest reduces correlations between trees by making sure trees are different from one another by including randomness at each split in the tree. Random forest was also chosen over bagged trees because it is faster, although it might not feel like it based on our final plot. The two hyper-parameters that were tuned for our random forest model were the <code>mtry</code> and the <code>min_n</code> parameters. Mtry is important because it is the main parameter of dealing with tree correlation by making sure the predictors chosen for the root nodes are different each time rather than only picking a handful of predictors as the root node. Min_n is important because this parameter decides whether or not the node splits further to make deeper trees. While not tuned, the number of trees was set to 1000 rather than the default of 500. From this model, we will be able to see which nodes are the most important predictors for students’ scores. Lastly, model performance will be assessed by RMSE to compare to the other two models’ performance.</p>
<p>When creating a random forest model, there are some additional arguments that are needed. First, it is important to use as many cores on your local computer as you can so you’re not waiting for forever while this model runs. The permutation argument is important for splitting and considers any variable important if it makes the predictive accuracy better and repeats it for each predictor.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='op'>(</span><span class='va'>cores</span> <span class='op'>&lt;-</span> <span class='fu'>parallel</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/parallel/detectCores.html'>detectCores</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>model_of_forests</span> <span class='op'>&lt;-</span> <span class='fu'>rand_forest</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
<span class='fu'>set_engine</span><span class='op'>(</span><span class='st'>"ranger"</span>,
num.threads <span class='op'>=</span> <span class='va'>cores</span>, <span class='co'>#</span>
importance <span class='op'>=</span> <span class='st'>"permutation"</span>, 
verbose <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
<span class='fu'>set_mode</span><span class='op'>(</span><span class='st'>"regression"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>set_args</span><span class='op'>(</span>mtry <span class='op'>=</span> <span class='fu'>tune</span><span class='op'>(</span><span class='op'>)</span>,
           trees <span class='op'>=</span> <span class='fl'>1000</span>,
           min_n <span class='op'>=</span> <span class='fu'>tune</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Next, we’ll update our existing workflow object to examine the random forest model in the previous code chunk. Now that we have our workflow created, we can then run the model and recipe to get the best RMSE value. We also set the grid to 10 to get 10 values of our hyper-parameters.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>forest_flo</span> <span class='op'>&lt;-</span> <span class='va'>knn_flo</span> <span class='op'>%&gt;%</span>
<span class='fu'>update_model</span><span class='op'>(</span><span class='va'>model_of_forests</span><span class='op'>)</span>

<span class='fu'>tictoc</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/tictoc/man/tic.html'>tic</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='va'>tune_random_trees</span> <span class='op'>&lt;-</span> <span class='fu'>tune_grid</span><span class='op'>(</span>
    <span class='va'>forest_flo</span>,
    resamples <span class='op'>=</span> <span class='va'>train_cv</span>,
    grid <span class='op'>=</span> <span class='fl'>10</span>,
    metrics <span class='op'>=</span> <span class='fu'>metric_set</span><span class='op'>(</span><span class='va'>rmse</span><span class='op'>)</span>,
    control <span class='op'>=</span> <span class='fu'>control_resamples</span><span class='op'>(</span>verbose <span class='op'>=</span> <span class='cn'>TRUE</span>, 
                               save_pred <span class='op'>=</span> <span class='cn'>TRUE</span>, 
                               extract <span class='op'>=</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='va'>x</span><span class='op'>)</span><span class='op'>)</span> 
<span class='fu'>tictoc</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/tictoc/man/tic.html'>toc</a></span><span class='op'>(</span><span class='op'>)</span>

<span class='va'>train_best</span> <span class='op'>&lt;-</span> <span class='fu'>select_best</span><span class='op'>(</span><span class='va'>tune_random_trees</span>, metric <span class='op'>=</span> <span class='st'>"rmse"</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Now that we have the best values for our hyper-parameters and have our RMSE, we can then finalize our workflow and run the last_fit to see how the random forest performed.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>train_wf_final</span> <span class='op'>&lt;-</span> <span class='fu'>finalize_workflow</span><span class='op'>(</span>
  <span class='va'>forest_flo</span>,
  <span class='va'>train_best</span>
<span class='op'>)</span>

<span class='fu'>tictoc</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/tictoc/man/tic.html'>tic</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='va'>train_res_final</span> <span class='op'>&lt;-</span> <span class='fu'>last_fit</span><span class='op'>(</span><span class='va'>train_wf_final</span>,
                            split <span class='op'>=</span> <span class='va'>d_split</span><span class='op'>)</span>
<span class='fu'>tictoc</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/tictoc/man/tic.html'>toc</a></span><span class='op'>(</span><span class='op'>)</span>

<span class='va'>train_res_final</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>collect_metrics</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h2 id="model-fits">Model Fits</h2>
<p>Now that we have examined all three different models using a small percentage of the actual data, we can discuss which model fits the data best. While it may be different for based on using a small percentage, if you happen to have a supercomputer, you can analyze the full dataset. In the following code chunk, we gathered information about the RMSE, which is the fit metric we are using, the amount of time it took to run the model with all the data, and the name of the model. We can see that the best fitting model is the random forest.</p>
<figure>
<img src="https://media.giphy.com/media/ndOEKTqUOEPq8/giphy.gif" alt="" /><figcaption>best tree</figcaption>
</figure>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>model_metrics</span> <span class='op'>&lt;-</span> <span class='fu'>tibble</span><span class='op'>(</span><span class='st'>'model'</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'Elastic Net Regression'</span>, <span class='st'>'KNN'</span>, <span class='st'>'Random Forest'</span><span class='op'>)</span>,
                           <span class='st'>'time'</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1552.90</span>, <span class='fl'>1772.52</span>, <span class='fl'>13919.06</span><span class='op'>)</span>,
                           <span class='st'>'rmse'</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>89.02</span>, <span class='fl'>92.20</span>, <span class='fl'>85.50</span><span class='op'>)</span><span class='op'>)</span>

<span class='fu'>ggplot</span><span class='op'>(</span><span class='va'>model_metrics</span>, <span class='fu'>aes</span><span class='op'>(</span><span class='va'>time</span>, <span class='va'>rmse</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_line</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>color <span class='op'>=</span> <span class='va'>model</span><span class='op'>)</span>, size <span class='op'>=</span> <span class='fl'>2.5</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://rdrr.io/r/graphics/plot.window.html'>xlim</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>15000</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>annotate</span><span class='op'>(</span><span class='st'>"text"</span>, x <span class='op'>=</span> <span class='fl'>1400</span>, y <span class='op'>=</span> <span class='fl'>88.55</span>, label <span class='op'>=</span> <span class='st'>"Elastic Net"</span>, size <span class='op'>=</span> <span class='fl'>5</span>, color <span class='op'>=</span> <span class='st'>'#12D7AD'</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>annotate</span><span class='op'>(</span><span class='st'>"text"</span>, x <span class='op'>=</span> <span class='fl'>2800</span>, y <span class='op'>=</span> <span class='fl'>92.30</span>, label <span class='op'>=</span> <span class='st'>"KNN*"</span>, size <span class='op'>=</span> <span class='fl'>5</span>, color <span class='op'>=</span> <span class='st'>'#127AD7'</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>annotate</span><span class='op'>(</span><span class='st'>"text"</span>, x <span class='op'>=</span> <span class='fl'>13500</span>, y <span class='op'>=</span> <span class='fl'>88.5</span>, label <span class='op'>=</span> <span class='st'>"Random Forest \n mtry = 5 \n min_n = 40 \n trees = 1000"</span>, size <span class='op'>=</span> <span class='fl'>5</span>, color <span class='op'>=</span> <span class='st'>'#D7126D'</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>title <span class='op'>=</span> <span class='st'>'Comparison of RMSE of three models fit'</span>,
       subtitle <span class='op'>=</span> <span class='st'>'Testing dataset predictions'</span>,
       y <span class='op'>=</span> <span class='st'>'RMSE'</span>,
       caption <span class='op'>=</span> <span class='st'>"* = KNN model did not tune all hyperparameters due to computation time\n Computations were conducted on the UO's Talapas "</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme_minimal</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme</span><span class='op'>(</span>legend.position <span class='op'>=</span> <span class='st'>"none"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_color_manual</span><span class='op'>(</span>values <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'#12D7AD'</span>, <span class='st'>'#127AD7'</span>, <span class='st'>'#D7126D'</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>However, it is important to note that while the random forest model was the best performing model, it also took substantially longer to run. This was also a determining factor in how many parameters we could tune in the KNN model, as it was computationally exhausting to run. Overall, the random forest was enough of a better performing model that we think it was best to run that over a penalized regression model. While feature engineering changes could have probably resulted in a better fitting model for all three, this blog was to compare the models with the same recipe. So if you decide to fit these three models, some takeaways are:</p>
<ol type="1">
<li><p>Feature engineering is an important to step to get the most out of your models. It also helps if you have background information regarding the data you are working with.</p></li>
<li><p>Think about the pros and cons of a better performing model and the time it takes to run the model.</p></li>
<li><p>Experiment with other models not shown here.</p></li>
<li><p>Try to find as much relevant data as possible to help in predicting your outcome of interest.</p></li>
</ol>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>test</span> <span class='op'>&lt;-</span> <span class='fu'>read_csv</span><span class='op'>(</span><span class='st'>"data/test.csv"</span>,
                 col_types <span class='op'>=</span> <span class='fu'>cols</span><span class='op'>(</span>.default <span class='op'>=</span> <span class='fu'>col_guess</span><span class='op'>(</span><span class='op'>)</span>, 
                                  calc_admn_cd <span class='op'>=</span> <span class='fu'>col_character</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'>#joins - edited</span>
<span class='va'>test1</span> <span class='op'>&lt;-</span> <span class='va'>test</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>left_join</span><span class='op'>(</span><span class='va'>frl_stu</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>left_join</span><span class='op'>(</span><span class='va'>staff</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>left_join</span><span class='op'>(</span><span class='va'>ethnicities</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>sample_frac</span><span class='op'>(</span><span class='fl'>.01</span><span class='op'>)</span>

<span class='co'>#workflow</span>
<span class='va'>fit_workflow</span> <span class='op'>&lt;-</span> <span class='fu'>fit</span><span class='op'>(</span><span class='va'>train_wf_final</span>, <span class='va'>d</span><span class='op'>)</span>

<span class='co'>#use model to make predictions for test dataset</span>
<span class='va'>preds_final</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>fit_workflow</span>, <span class='va'>test1</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/str.html'>str</a></span><span class='op'>(</span><span class='va'>d</span><span class='op'>)</span>

<span class='va'>pred_frame</span> <span class='op'>&lt;-</span> <span class='fu'>tibble</span><span class='op'>(</span>Id <span class='op'>=</span> <span class='va'>test1</span><span class='op'>$</span><span class='va'>id</span>, Predicted <span class='op'>=</span> <span class='va'>preds_final</span><span class='op'>$</span><span class='va'>.pred</span><span class='op'>)</span>

<span class='fu'>ggplot</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>d</span>, <span class='fu'>aes</span><span class='op'>(</span><span class='va'>id</span>, <span class='va'>score</span><span class='op'>)</span>, color <span class='op'>=</span> <span class='st'>'#D7126D'</span>, alpha <span class='op'>=</span> <span class='fl'>.5</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>pred_frame</span>, <span class='fu'>aes</span><span class='op'>(</span><span class='va'>Id</span>, <span class='va'>Predicted</span><span class='op'>)</span>, color <span class='op'>=</span> <span class='st'>'#12D7AD'</span>, alpha <span class='op'>=</span> <span class='fl'>.7</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme_minimal</span><span class='op'>(</span><span class='op'>)</span>

<span class='co'># write_csv(pred_frame, "fit2-final-st-editrecipe.csv") #edited</span>

<span class='co'># saveRDS(train_res_final, "prelimfit2_finalfit-st-editrecipe.Rds")#added to save RDS object for final</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='co'>#update with final chosen model (best fit)</span>
<span class='co'>#If you want to use your model to predict the response for new observations, you need to use the fit() function on your workflow and the dataset that you want to fit the final model on (e.g. the complete training + testing dataset). </span>

<span class='co'>#workflow</span>
<span class='va'>fit_workflow</span> <span class='op'>&lt;-</span> <span class='fu'>fit</span><span class='op'>(</span><span class='va'>FINALIZED_WORKFLOW_OBJECT_NAME</span>, <span class='va'>d</span><span class='op'>)</span><span class='co'>#Should this be d_train based on lab 3key. This blog says not - http://www.rebeccabarter.com/blog/2020-03-25_machine_learning/</span>

<span class='va'>fit_workflow</span> <span class='co'>#view</span>

<span class='co'>#use model to make predictions for test dataset (adding test1 as new data)</span>
<span class='va'>preds_final</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>fit_workflow</span>, <span class='va'>test1</span><span class='op'>)</span>

<span class='co'>######################</span>
<span class='va'>pred_frame</span> <span class='op'>&lt;-</span> <span class='fu'>tibble</span><span class='op'>(</span>Id <span class='op'>=</span> <span class='va'>test1</span><span class='op'>$</span><span class='va'>id</span>, Predicted <span class='op'>=</span> <span class='va'>preds_final</span><span class='op'>$</span><span class='va'>.pred</span><span class='op'>)</span>

<span class='co'>#write_csv(pred_frame, "FILE-NAME.csv")</span>
</code></pre>
</div>
</div>
<div class="sourceCode" id="cb5"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom"></div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
